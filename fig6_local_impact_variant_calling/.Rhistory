my_colors = c(genotube = "firebrick", TBprofiler = "chocolate1")
custom_facet_labels <- c("NEUTRAL" = "Neutral", "TOTAL" = "TOTAL",
"IS_flanking_regions" = "IS flanking\n regions",
"insertion_flanking_regions"="Ancestral-like\nflanking regions",
"IS_scar_regions"="IS scar\n regions",
"DR_scar_regions"="Deletion scar\nregions",
"duplicated_region"="Duplicated\nregion")
custom_facet_labeller <- as_labeller(custom_facet_labels)
custom_facet_colors <- c("NEUTRAL" = "black",
"DR_scar_regions" = "cornflowerblue",
"insertion_flanking_regions" = "darkorchid4",
"IS_flanking_regions" = "darkolivegreen",
"IS_scar_regions" = "chartreuse4",
"duplicated_region" = "deeppink4")
duplication_labeller <- as_labeller(c(with_dupli = "With duplication regions", without_dupli = "Without duplication region"))
} #structural variants table
PRECISION <- ggplot(results_by_region, aes(x = region2, y = as.numeric(PRECISION), fill = region2)) +
geom_abline(slope = 0, intercept = seq(0, 1, by = 0.1), linetype = "dotted") +
geom_vline(xintercept = c(1.5 , 2.5, 3.5, 4.5, 5.5), linetype = "dotted") +
geom_vline(xintercept = 6.5, linetype = "solid") +
geom_violin(weight = 1/2, position = position_dodge(), scale = "width") +
geom_point(alpha = 0.5, shape = 21, position = position_jitterdodge(jitter.width = 0.5)) +
theme_classic()  + ylab("PRECISION") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1),
expand = expansion(mult = c(0, 0.3))
) +
coord_cartesian(ylim=c(0, 1)) +
scale_fill_manual(name = element_blank(), values = custom_facet_colors) +
scale_alpha(guide = 'none') +
theme(text = element_text(NA),
strip.text = element_text(size = 10, face = "bold", hjust = 0.5),
axis.title.y = element_text(size = 14, face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.text.x = element_blank(), #element_text(size = 10, face = "bold", angle = 45, hjust = 1),
legend.position = "none",
strip.background = element_blank(),
panel.spacing = unit(0, "lines"),
axis.ticks.x = element_blank(), axis.line.x = element_blank()
) +
facet_wrap(~ experience, nrow = 1, scales = "free_x",labeller = duplication_labeller, strip.position = "top")
RECALL <- ggplot(results_by_region, aes(x = region2, y = as.numeric(RECALL), fill = region2)) +
geom_abline(slope = 0, intercept = seq(0, 1, by = 0.1), linetype = "dotted") +
geom_vline(xintercept = c(1.5 , 2.5, 3.5, 4.5, 5.5), linetype = "dotted") +
geom_vline(xintercept = 6.5, linetype = "solid") +
geom_violin(weight = 1/2, position = position_dodge(), scale = "width") +
geom_point(alpha = 0.5, shape = 21, position = position_jitterdodge(jitter.width = 0.5)) +
theme_classic()  + ylab("RECALL") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1),
expand = expansion(mult = c(0, 0.3))
) +
scale_x_discrete(labels = custom_facet_labels) +
coord_cartesian(ylim=c(0, 1)) +
scale_fill_manual(name = element_blank(), values = custom_facet_colors) +
scale_alpha(guide = 'none') +
theme(text = element_text(NA),
strip.text = element_blank(), #element_text(size = 10, face = "bold", hjust = 0.5),
axis.title.y = element_text(size = 14, face = "bold", hjust = 0.5),
axis.title.x = element_blank(), legend.position = "bottom", strip.background = element_blank(), panel.spacing = unit(0, "lines"), axis.ticks.x = element_blank(),
axis.text.x = element_text(colour = rep(custom_facet_colors, 2), size = 10, face = "bold", angle = 45, hjust = 1)
) +
facet_wrap(~ experience, nrow = 1, scales = "free_x", labeller = duplication_labeller)
PRECISION / RECALL
precision_neutral_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == "NEUTRAL")$PRECISION
recall_neutral_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == "NEUTRAL")$RECALL
recall_neutral_with_dupli
precision_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "duplication_region")$PRECISION
recall_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$RECALL
my_region = 'duplicated_region'
test_precision_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$PRECISION
test_recall_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$RECALL
test_precision_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$PRECISION
test_recall_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$RECALL
#PRECISION WITH
two.wilcox.test <- wilcox.test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, alternative = "less"); two.wilcox.test
my_region = 'DR_scar_regions'
test_precision_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$PRECISION
test_precision_with_dupli
test_recall_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$RECALL
test_precision_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$PRECISION
test_recall_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$RECALL
#PRECISION WITH
two.wilcox.test <- wilcox.test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITH
two.wilcox.test <- wilcox.test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#PRECISION WITHOUT
two.wilcox.test <- wilcox.test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, alternative = "less"); two.wilcox.test
test_precision_without_dupli
precision_neutral_without_dupli
precision_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "duplication_region")$PRECISION
recall_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$RECALL
#PRECISION WITHOUT
two.wilcox.test <- wilcox.test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, alternative = "less"); two.wilcox.test
precision_neutral_without_dupli
precision_neutral_without_dupli
precision_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$PRECISION
recall_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$RECALL
#PRECISION WITHOUT
two.wilcox.test <- wilcox.test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITHOUT
two.wilcox.test <- wilcox.test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
two.perm.test <- two_sample_test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
two.perm.test <- two_sample_test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, B = 100000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
two.perm.test <- two_sample_test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, B = 100000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
View(results_by_region)
results_by_region$region2
my_region = 'insertion_flanking_regions'
test_precision_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$PRECISION
test_recall_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$RECALL
test_precision_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$PRECISION
test_recall_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$RECALL
#PRECISION WITH
two.wilcox.test <- wilcox.test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITH
two.wilcox.test <- wilcox.test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#PRECISION WITH
two.wilcox.test <- wilcox.test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITH
two.wilcox.test <- wilcox.test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#PRECISION WITHOUT
two.wilcox.test <- wilcox.test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITHOUT
two.wilcox.test <- wilcox.test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
my_region = 'IS_flanking_regions'
test_precision_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$PRECISION
test_precision_with_dupli
test_recall_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$RECALL
test_precision_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$PRECISION
test_recall_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$RECALL
#PRECISION WITH
two.wilcox.test <- wilcox.test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITH
two.wilcox.test <- wilcox.test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITH
two.wilcox.test <- wilcox.test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#PRECISION WITHOUT
two.wilcox.test <- wilcox.test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITHOUT
two.wilcox.test <- wilcox.test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
my_region = 'IS_scar_regions'
test_precision_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$PRECISION
test_recall_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$RECALL
test_precision_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$PRECISION
test_recall_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$RECALL
#PRECISION WITH
two.wilcox.test <- wilcox.test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITH
two.wilcox.test <- wilcox.test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#PRECISION WITHOUT
two.wilcox.test <- wilcox.test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_without_dupli, x = test_precision_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITHOUT
two.wilcox.test <- wilcox.test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_without_dupli, x = test_recall_without_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
my_region = 'duplicated_region'
test_precision_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$PRECISION
test_recall_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == my_region)$RECALL
test_precision_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$PRECISION
test_precision_without_dupli
test_recall_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == my_region)$RECALL
#PRECISION WITH
two.wilcox.test <- wilcox.test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = precision_neutral_with_dupli, x = test_precision_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
#RECALL WITH
two.wilcox.test <- wilcox.test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, alternative = "less"); two.wilcox.test
two.perm.test <- two_sample_test(y = recall_neutral_with_dupli, x = test_recall_with_dupli, B = 10000, alternative = "left_tail", stats = list(stat_welch), type = "exact") ; two.perm.test$observed ; two.perm.test$pvalue
{
rm(list = ls())
gc()
graphics.off()
library(ggplot2)
library(gridExtra)
library(scales)
library(patchwork)
library(gghalves)
library(ggpp)
library(ggpubr)
my_colors = c(maketube = "firebrick", snpmutator = "chocolate1")
custom_facet_labels <- c("nucmer" = "Nucmer", "minimap2" = "Minimap2")
custom_facet_labeller <- as_labeller(custom_facet_labels)
}
maketube_results <- na.omit(read.table("nucmer_minimap2_results.tsv", sep = "\t", header = T))
colnames(maketube_results) <- c("sample", "pipeline", "structural_variant", "FILTER", "TOTAL", "TOTAL2", "VARIANT_CLASS", "TP", "FP", "FN", "RECALL", "PRECISION", "F1")
SNP <- subset(maketube_results,
(pipeline == "maketube" |
pipeline == "snpmutator") &
VARIANT_CLASS == "snp" & structural_variant == "w_duplicated")
{
rm(list = ls())
gc()
graphics.off()
library(ggplot2)
library(gridExtra)
library(scales)
library(grDevices)
library(flipr)
library(patchwork)
} #start
{
results_by_region <- read.table("metrics_near_structural_variants.tsv", sep = "\t", header = F)
colnames(results_by_region) <- c("pipeline", "strain", "experiment", "region", "region2", "variant_class", "TP", "FP", "FN", "RECALL", "PRECISION")
neutral_genotube <- subset(results_by_region, pipeline == "genotube" & region == 'ANTIBIOTIC_GENE' & variant_class == "snp")
#reference_region_size <- 3842481
reference_region_size <- 50000
PV <- (sum(as.numeric(neutral_genotube$TP)) + sum(as.numeric(neutral_genotube$FN)))/(reference_region_size*200)
PIV <- 1 - PV
PTP_genotube <- sum(neutral_genotube$TP) / (sum(neutral_genotube$TP) + sum(neutral_genotube$FN))
PFN_genotube <- 1-PTP_genotube
PFP_genotube <- sum(neutral_genotube$FP)/reference_region_size*200
precision_calculator <- function(size, replicate, PTP, PFP, PFN, tag1, tag2){
TP <- rbinom(replicate, size, PTP)
FP <- rbinom(replicate, size, PFP)
FN <- rbinom(replicate, size, PFN)
PRECISION <- TP / (TP + FP)
RECALL <- TP / (TP + FN)
output <- cbind(tag1, tag2, size, TP, FP, FN, RECALL, PRECISION)
return(output)
}
}
{
interval_size = c("DR_scar_regions" = 1800, "insertion_flanking_regions" = 4800, "IS_flanking_regions" = 9600, "IS_scar_regions" = 9600, "ANTIBIOTIC_GENE" = 50000, "duplicated_region" = 150000)
tmp <- lapply(names(interval_size), function(region_name) {
precision_calculator(interval_size[region_name], 200, PTP_genotube*PV, 0, PFN_genotube*PV, "genotube_theoretical", region_name)
})
genotube_theoretical_distribution <- as.data.frame(do.call(rbind, tmp))
colnames(genotube_theoretical_distribution) <- c("pipeline", "region", "strain", "TP", "FP", "FN", "RECALL", "PRECISION")
tmp <- lapply(names(interval_size), function(region_name) precision_calculator(interval_size[region_name], 2000, PTP_tbprofiler*PV, PFP_tbprofiler*PIV, PFN_tbprofiler*PV, "tbprofiler_theoretical", region_name))
tb_profiler_theoretical_distribution <- as.data.frame(do.call(rbind, tmp))
colnames(tb_profiler_theoretical_distribution) <- c("pipeline", "region", "strain", "TP", "FP", "FN", "RECALL", "PRECISION")
both_distributions <- rbind(genotube_theoretical_distribution, tb_profiler_theoretical_distribution)[, -3]
both_distributions$TP <- as.numeric(both_distributions$TP)
both_distributions$FP <- as.numeric(both_distributions$FP)
both_distributions$FN <- as.numeric(both_distributions$FN)
both_distributions$PRECISION <- as.numeric(both_distributions$PRECISION)
both_distributions$RECALL <- as.numeric(both_distributions$RECALL)
both_distributions <- both_distributions[!(is.na(both_distributions$RECALL) | is.na(both_distributions$PRECISION)),]
#write.table(both_distributions, file = "theoretical_distributions.tsv", sep = "\t", row.names = F)
}
{
rm(list = ls())
gc()
graphics.off()
library(ggplot2)
library(gridExtra)
library(scales)
library(grDevices)
library(flipr)
library(patchwork)
} #start
{
results_by_region <- read.table("metrics_near_structural_variants.tsv", sep = "\t", header = F)
colnames(results_by_region) <- c("pipeline", "strain", "experiment", "region", "region2", "variant_class", "TP", "FP", "FN", "RECALL", "PRECISION")
neutral_genotube <- subset(results_by_region, pipeline == "genotube" & region == 'ANTIBIOTIC_GENE' & variant_class == "snp")
#reference_region_size <- 3842481
reference_region_size <- 50000
PV <- (sum(as.numeric(neutral_genotube$TP)) + sum(as.numeric(neutral_genotube$FN)))/(reference_region_size*200)
PIV <- 1 - PV
PTP_genotube <- sum(neutral_genotube$TP) / (sum(neutral_genotube$TP) + sum(neutral_genotube$FN))
PFN_genotube <- 1-PTP_genotube
PFP_genotube <- sum(neutral_genotube$FP)/reference_region_size*200
precision_calculator <- function(size, replicate, PTP, PFP, PFN, tag1, tag2){
TP <- rbinom(replicate, size, PTP)
FP <- rbinom(replicate, size, PFP)
FN <- rbinom(replicate, size, PFN)
PRECISION <- TP / (TP + FP)
RECALL <- TP / (TP + FN)
output <- cbind(tag1, tag2, size, TP, FP, FN, RECALL, PRECISION)
return(output)
}
}
{
interval_size = c("DR_scar_regions" = 1800, "insertion_flanking_regions" = 4800, "IS_flanking_regions" = 9600, "IS_scar_regions" = 9600, "ANTIBIOTIC_GENE" = 50000, "duplicated_region" = 150000)
tmp <- lapply(names(interval_size), function(region_name) {
precision_calculator(interval_size[region_name], 200, PTP_genotube*PV, 0, PFN_genotube*PV, "genotube_theoretical", region_name)
})
genotube_theoretical_distribution <- as.data.frame(do.call(rbind, tmp))
colnames(genotube_theoretical_distribution) <- c("pipeline", "region", "strain", "TP", "FP", "FN", "RECALL", "PRECISION")
tmp <- lapply(names(interval_size), function(region_name) precision_calculator(interval_size[region_name], 2000, PTP_tbprofiler*PV, PFP_tbprofiler*PIV, PFN_tbprofiler*PV, "tbprofiler_theoretical", region_name))
tb_profiler_theoretical_distribution <- as.data.frame(do.call(rbind, tmp))
colnames(tb_profiler_theoretical_distribution) <- c("pipeline", "region", "strain", "TP", "FP", "FN", "RECALL", "PRECISION")
both_distributions <- rbind(genotube_theoretical_distribution, tb_profiler_theoretical_distribution)[, -3]
both_distributions$TP <- as.numeric(both_distributions$TP)
both_distributions$FP <- as.numeric(both_distributions$FP)
both_distributions$FN <- as.numeric(both_distributions$FN)
both_distributions$PRECISION <- as.numeric(both_distributions$PRECISION)
both_distributions$RECALL <- as.numeric(both_distributions$RECALL)
both_distributions <- both_distributions[!(is.na(both_distributions$RECALL) | is.na(both_distributions$PRECISION)),]
#write.table(both_distributions, file = "theoretical_distributions.tsv", sep = "\t", row.names = F)
}
{
results_by_region <- read.table("metrics_near_structural_variants.tsv", sep = "\t", header = F)[,c(1,3,5:9)]
results_by_region <- subset(results_by_region, V6 == "snp")[, -4]
colnames(results_by_region) <- c("pipeline", "experiment", "region", "TP", "FP", "FN")
results_by_region$PRECISION = results_by_region$TP / (results_by_region$FP + results_by_region$TP)
results_by_region$RECALL = results_by_region$TP / (results_by_region$FN + results_by_region$TP)
void_vector <- as.data.frame(t(sapply(unique(results_by_region$region), function(x) c("void", x, -1, -1, -1, -1, -1), USE.NAMES = F)))
colnames(void_vector) <- c("pipeline", "region", "TP", "FP", "FN", "RECALL", "PRECISION")
structural_variants <- rbind(results_by_region, void_vector)
structural_variants$pipeline <- factor(structural_variants$pipeline, levels = c("genotube_theoretical", "genotube", "void", "tbprofiler_theoretical", "TBprofiler"), ordered = T)
structural_variants <- na.omit(structural_variants[(structural_variants$pipeline == "genotube" | structural_variants$pipeline == "TBprofiler") & structural_variants$region != "TOTAL" & structural_variants$region != "ANTIBIOTIC_GENE", ])
my_colors = c(genotube = "firebrick", tbprofiler_theoretical = "orange4", TBprofiler = "chocolate1", genotube_theoretical = "pink3")
} #structural variants table
{
custom_facet_labels <- c("IS_flanking_regions" = "IS flanking\n regions",
"insertion_flanking_regions"="insertion flanking\n regions",
"IS_scar_regions"="IS scar\n regions",
"DR_scar_regions"="DR scar\n regions",
"duplicated_region"="duplicated region")
custom_facet_labeller <- as_labeller(custom_facet_labels)
}
{
rm(list = ls())
gc()
graphics.off()
library(ggplot2)
library(gridExtra)
library(scales)
library(grDevices)
library(flipr)
library(patchwork)
library(gghalves)
library(ggpp)
library(ggdist)
} #start
results_by_region <- read.table("results_by_regions_with_without_duplicated.every_at_10k.bed", sep = "\t", header = F)
colnames(results_by_region) <- c("pipeline", "strain", "experience", "region", "region2", "variant_class", "TP", "FP", "FN", "RECALL", "PRECISION", "F1")
{
results_by_region$pipeline <- factor(results_by_region$pipeline, levels = c("genotube", "TBprofiler"), ordered = T)
results_by_region$pipeline <- factor(results_by_region$pipeline, levels = c("genotube", "TBprofiler"), ordered = T)
results_by_region$region2 <- factor(results_by_region$region2, levels = c("NEUTRAL", "DR_scar_regions", "insertion_flanking_regions", "IS_flanking_regions", "IS_scar_regions", "duplicated_region"), ordered = T)
results_by_region <- subset(results_by_region, region2 != "TOTAL" & variant_class == "snp" & PRECISION > 0)
#results_by_region <- results_by_region[results_by_region$variant_class == "snp" & results_by_region$region2 != "TOTAL", ]
my_colors = c(genotube = "firebrick", TBprofiler = "chocolate1")
custom_facet_labels <- c("NEUTRAL" = "Neutral", "TOTAL" = "TOTAL",
"IS_flanking_regions" = "IS flanking\n regions",
"insertion_flanking_regions"="Ancestral-like\nflanking regions",
"IS_scar_regions"="IS scar\n regions",
"DR_scar_regions"="Deletion scar\nregions",
"duplicated_region"="Duplicated\nregion")
custom_facet_labeller <- as_labeller(custom_facet_labels)
custom_facet_colors <- c("NEUTRAL" = "black",
"DR_scar_regions" = "cornflowerblue",
"insertion_flanking_regions" = "darkorchid4",
"IS_flanking_regions" = "darkolivegreen",
"IS_scar_regions" = "chartreuse4",
"duplicated_region" = "deeppink4")
duplication_labeller <- as_labeller(c(with_dupli = "With duplication regions", without_dupli = "Without duplication region"))
} #structural variants table
PRECISION <- ggplot(results_by_region, aes(x = region2, y = as.numeric(PRECISION), fill = region2)) +
geom_abline(slope = 0, intercept = seq(0, 1, by = 0.1), linetype = "dotted") +
geom_vline(xintercept = c(1.5 , 2.5, 3.5, 4.5, 5.5), linetype = "dotted") +
geom_vline(xintercept = 6.5, linetype = "solid") +
geom_violin(weight = 1/2, position = position_dodge(), scale = "width") +
geom_point(alpha = 0.5, shape = 21, position = position_jitterdodge(jitter.width = 0.5)) +
theme_classic()  + ylab("PRECISION") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1),
expand = expansion(mult = c(0, 0.3))
) +
coord_cartesian(ylim=c(0, 1)) +
scale_fill_manual(name = element_blank(), values = custom_facet_colors) +
scale_alpha(guide = 'none') +
theme(text = element_text(NA),
strip.text = element_text(size = 10, face = "bold", hjust = 0.5),
axis.title.y = element_text(size = 14, face = "bold", hjust = 0.5),
axis.title.x = element_blank(),
axis.text.x = element_blank(), #element_text(size = 10, face = "bold", angle = 45, hjust = 1),
legend.position = "none",
strip.background = element_blank(),
panel.spacing = unit(0, "lines"),
axis.ticks.x = element_blank(), axis.line.x = element_blank()
) +
facet_wrap(~ experience, nrow = 1, scales = "free_x",labeller = duplication_labeller, strip.position = "top")
RECALL <- ggplot(results_by_region, aes(x = region2, y = as.numeric(RECALL), fill = region2)) +
geom_abline(slope = 0, intercept = seq(0, 1, by = 0.1), linetype = "dotted") +
geom_vline(xintercept = c(1.5 , 2.5, 3.5, 4.5, 5.5), linetype = "dotted") +
geom_vline(xintercept = 6.5, linetype = "solid") +
geom_violin(weight = 1/2, position = position_dodge(), scale = "width") +
geom_point(alpha = 0.5, shape = 21, position = position_jitterdodge(jitter.width = 0.5)) +
theme_classic()  + ylab("RECALL") +
scale_y_continuous(breaks = seq(0, 1, by = 0.1),
expand = expansion(mult = c(0, 0.3))
) +
scale_x_discrete(labels = custom_facet_labels) +
coord_cartesian(ylim=c(0, 1)) +
scale_fill_manual(name = element_blank(), values = custom_facet_colors) +
scale_alpha(guide = 'none') +
theme(text = element_text(NA),
strip.text = element_blank(), #element_text(size = 10, face = "bold", hjust = 0.5),
axis.title.y = element_text(size = 14, face = "bold", hjust = 0.5),
axis.title.x = element_blank(), legend.position = "bottom", strip.background = element_blank(), panel.spacing = unit(0, "lines"), axis.ticks.x = element_blank(),
axis.text.x = element_text(colour = rep(custom_facet_colors, 2), size = 10, face = "bold", angle = 45, hjust = 1)
) +
facet_wrap(~ experience, nrow = 1, scales = "free_x", labeller = duplication_labeller)
PRECISION / RECALL
PRECISION / RECALL
precision_neutral_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == "NEUTRAL")$PRECISION
recall_neutral_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == "NEUTRAL")$RECALL
precision_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$PRECISION
recall_neutral_without_dupli <- subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$RECALL
precision_neutral_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == "NEUTRAL")$PRECISION
recall_neutral_with_dupli <- subset(results_by_region, experience == "with_dupli" & region2 == "NEUTRAL")$RECALL
results_by_region$region2
unique(results_by_region$region2)
subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")
unique(results_by_region$region2)
subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$FN
mean(subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$FN)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "insertion_flanking_regions")$FN)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "IS_flanking_regions")$FN)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "IS_scar_regions")$FN)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "DR_scar_regions")$FN)
mean(subset(results_by_region, experience == "with_dupli" & region2 == "duplicated_region")$FN)
mean(subset(results_by_region, experience == "with_dupli" & region2 == "duplicated_region")$TP)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "with_dupli" & region2 == "DR_scar_regions")$TP)
mean(subset(results_by_region, experience == "with_dupli" & region2 == "insertion_flanking_regions")$TP)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "with_dupli" & region2 == "IS_flanking_regions")$TP)
mean(subset(results_by_region, experience == "with_dupli" & region2 == "IS_scar_regions")$TP)
mean(subset(results_by_region, experience == "with_dupli" & region2 == "NEUTRAL")$TP)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$FP)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$FP)
subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")
mean(subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$TP)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "DR_scar_regions")$TP)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "insertion_flanking_regions")$TP)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "NEUTRAL")$FP)
unique(results_by_region$region2)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "DR_scar_regions")$FP)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "insertion_flanking_regions")$FP)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "IS_flanking_regions")$FP)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "IS_scar_region")$FP)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "IS_scar_regions")$FP)
subset(results_by_region, experience == "without_dupli" & region2 == "IS_scar_regions")$FP
subset(results_by_region, experience == "without_dupli" & region2 == "IS_flanking_regions")$FP
results_by_region
subset(results_by_region, experience == "without_dupli" & region2 == "IS_flanking_regions")
View(subset(results_by_region, experience == "without_dupli" & region2 == "IS_flanking_regions"))
subset(results_by_region, experience == "without_dupli" & region2 == "IS_flanking_regions")$FP
mean(subset(results_by_region, experience == "without_dupli" & region2 == "IS_flanking_regions")$FP)
mean(subset(results_by_region, experience == "without_dupli" & region2 == "insertion_flanking_regions")$FP)
subset(results_by_region, experience == "without_dupli" & region2 == "insertion_flanking_regions")$FP
?wilcox.test
{
rm(list = ls())
gc()
graphics.off()
library(ggplot2)
library(gridExtra)
library(scales)
library(grDevices)
library(flipr)
library(patchwork)
library(gghalves)
library(ggpp)
library(ggdist)
} #start
results_by_region <- read.table("results_by_regions_with_without_duplicated.every_at_10k.bed", sep = "\t", header = F)
colnames(results_by_region) <- c("pipeline", "strain", "experience", "region", "region2", "variant_class", "TP", "FP", "FN", "RECALL", "PRECISION", "F1")
rsubset(results_by_region, experience == "with_duplicated")
subset(results_by_region, experience == "with_duplicated")
subset(results_by_region, experience == "with_dupli")
subset(results_by_regionn region2 == "TOTAL" & experience == "with_dupli")
subset(results_by_region, region2 == "TOTAL" & experience == "with_dupli")
size(subset(results_by_region, region2 == "TOTAL" & experience == "with_dupli"))
dim(subset(results_by_region, region2 == "TOTAL" & experience == "with_dupli"))
sum(subset(results_by_region, region2 == "TOTAL" & experience == "with_dupli")$TP)
sum(subset(results_by_region, region2 == "TOTAL" & experience == "with_dupli")$FN)
sum(subset(results_by_region, region2 == "TOTAL" & experience == "with_dupli")$FP)
results_by_region$regions
results_by_region$region2
unique(results_by_region$region2)
sum(subset(results_by_region, region2 == "TOTAL" & experience == "without_dupli")$TP)
sum(subset(results_by_region, region2 == "TOTAL" & experience == "without_dupli")$FN)
sum(subset(results_by_region, region2 == "TOTAL" & experience == "without_dupli")$FP)
unique(results_by_region$region2)
sum(subset(results_by_region, region2 == "DR_scar_regions" & experience == "without_dupli")$FP)
sum(subset(results_by_region, region2 == "DR_scar_regions" & experience == "without_dupli")$TP)
sum(subset(results_by_region, region2 == "DR_scar_regions" & experience == "without_dupli")$FN)
sum(subset(results_by_region, region2 == "DR_scar_regions" & experience == "without_dupli")$FP)
unique(results_by_region$region2)
sum(subset(results_by_region, region2 == "insertion_flanking_regions" & experience == "without_dupli")$TP)
sum(subset(results_by_region, region2 == "insertion_flanking_regions" & experience == "without_dupli")$FN)
sum(subset(results_by_region, region2 == "insertion_flanking_regions" & experience == "without_dupli")$FP)
sum(subset(results_by_region, region2 == "IS_flanking_regions" & experience == "without_dupli")$TP)
sum(subset(results_by_region, region2 == "IS_flanking_regions" & experience == "without_dupli")$FN)
sum(subset(results_by_region, region2 == "IS_flanking_regions" & experience == "without_dupli")$FP)
sum(subset(results_by_region, region2 == "IS_scar_regions" & experience == "without_dupli")$TP)
sum(subset(results_by_region, region2 == "IS_scar_regions" & experience == "without_dupli")$FN)
sum(subset(results_by_region, region2 == "IS_scar_regions" & experience == "without_dupli")$FP)
