plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
scale_y_discrete(labels = c(PAF$qname[1], PAF$tname[1]))
} else {
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
}
plot_object <- ggplot_build(plot)
plot_object$data[[2]][1, "fill"] <- col1
plot_object$data[[2]][2, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
return(plot_recolored)
}
PAF <- read_paf(list.files("PAF", pattern = "H37Rv_mutated_9_L4_H37Rv", full.names = T))
plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1])
{
natA <- paf2synteny("CDC1551_L4_H37Rv", col1 = "darkgreen", col2 = "darkgreen", my_subtitle = "Natural genome /<br> reference")
natB <- paf2synteny("W-148_L2_18b.paf", col1 = "darkgreen", col2 = "darkgreen")
natC <- paf2synteny("BCG_Pasteur_bovis_AF2122-97", col1 = "darkgreen", col2 = "darkgreen")
snpmutatorA <- paf2synteny("H37Rv_mutated_9_L4_H37Rv", "(snpmutator)", col1 = "darkgreen", col2 = "orange", my_subtitle = "snpmutator genome /<br> reference")
snpmutatorB <- paf2synteny("18b_mutated_9_L2_18b", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
snpmutatorC <- paf2synteny("AF2122-97_mutated_1_bovis_AF2122-97", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
maketubeA <- paf2synteny("SV2_pop1_H9_L4_H37Rv", "(maketube)", col1 = "darkgreen", col2 = "firebrick", my_subtitle = "maketube genome /<br> reference")
maketubeB <- paf2synteny("SV1_pop1_H1_L2_18b", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
maketubeC <- paf2synteny("SV3_pop1_H10_bovis_AF2122", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
}
big_plot <- (natA / natB / natC) | (snpmutatorA / snpmutatorB / snpmutatorC) | (maketubeA / maketubeB / maketubeC)
big_plot
paf2synteny <- function(pattern_input, target_append = NULL, col1 = "violet", col2 = "purple", my_subtitle = NA, reference = NA){
PAF <- read_paf(list.files("PAF", pattern = pattern_input, full.names = T))
if(!is.null(target_append)){
PAF$qname <- paste(unique(PAF$qname)[1], target_append, sep = "\n")
}
if(is.na(my_subtitle)){
title_format <- element_blank()
} else {
title_format <- element_markdown(
face = "bold",
hjust = 0.5, vjust = 0,
box.color = "black",
linewidth = 0.75, linetype = 1,
padding = margin(10, 30, 10, 30),
margin = margin(0)
)
}
if(!is.na(reference) & (radical(unique(PAF$tname)[1]) == radical(reference))){
tmp <- col1
col1 <- col2
col2 <- tmp
}
if(PAF$tlen[1] > PAF$qlen[1]){
paf_swapped <- PAF
paf_swapped$qname  <- PAF$tname
paf_swapped$tname  <- PAF$qname
PAF <- paf_swapped
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
scale_y_discrete(labels = c(PAF$qname[1], PAF$tname[1]))
} else {
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
}
plot_object <- ggplot_build(plot)
plot_object$data[[2]][1, "fill"] <- col1
plot_object$data[[2]][2, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
return(plot_recolored)
}
PAF <- read_paf(list.files("PAF", pattern = "H37Rv_mutated_9_L4_H37Rv", full.names = T))
plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1])
{
natA <- paf2synteny("CDC1551_L4_H37Rv", col1 = "darkgreen", col2 = "darkgreen", my_subtitle = "Natural genome /<br> reference")
natB <- paf2synteny("W-148_L2_18b.paf", col1 = "darkgreen", col2 = "darkgreen")
natC <- paf2synteny("BCG_Pasteur_bovis_AF2122-97", col1 = "darkgreen", col2 = "darkgreen")
snpmutatorA <- paf2synteny("H37Rv_mutated_9_L4_H37Rv", "(snpmutator)", col1 = "darkgreen", col2 = "orange", my_subtitle = "snpmutator genome /<br> reference")
snpmutatorB <- paf2synteny("18b_mutated_9_L2_18b", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
snpmutatorC <- paf2synteny("AF2122-97_mutated_1_bovis_AF2122-97", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
maketubeA <- paf2synteny("SV2_pop1_H9_L4_H37Rv", "(maketube)", col1 = "darkgreen", col2 = "firebrick", my_subtitle = "maketube genome /<br> reference")
maketubeB <- paf2synteny("SV1_pop1_H1_L2_18b", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
maketubeC <- paf2synteny("SV3_pop1_H10_bovis_AF2122", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
}
big_plot <- (natA / natB / natC) | (snpmutatorA / snpmutatorB / snpmutatorC) | (maketubeA / maketubeB / maketubeC)
big_plot
paf2synteny <- function(pattern_input, target_append = NULL, col1 = "violet", col2 = "purple", my_subtitle = NA, reference = NA){
PAF <- read_paf(list.files("PAF", pattern = pattern_input, full.names = T))
if(!is.null(target_append)){
PAF$qname <- paste(unique(PAF$qname)[1], target_append, sep = "\n")
}
if(is.na(my_subtitle)){
title_format <- element_blank()
} else {
title_format <- element_markdown(
face = "bold",
hjust = 0.5, vjust = 0,
box.color = "black",
linewidth = 0.75, linetype = 1,
padding = margin(10, 30, 10, 30),
margin = margin(0)
)
}
if(!is.na(reference) & (radical(unique(PAF$tname)[1]) == radical(reference))){
tmp <- col1
col1 <- col2
col2 <- tmp
}
if(PAF$tlen[1] > PAF$qlen[1]){
paf_swapped <- PAF
paf_swapped$qname  <- PAF$tname
paf_swapped$tname  <- PAF$qname
PAF <- paf_swapped
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
scale_y_discrete(labels = c(PAF$qname[1], PAF$tname[1]))
} else {
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
}
plot_object <- ggplot_build(plot)
plot_object$data[[2]][2, "fill"] <- col1
plot_object$data[[2]][1, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
return(plot_recolored)
}
PAF <- read_paf(list.files("PAF", pattern = "H37Rv_mutated_9_L4_H37Rv", full.names = T))
plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1])
{
natA <- paf2synteny("CDC1551_L4_H37Rv", col1 = "darkgreen", col2 = "darkgreen", my_subtitle = "Natural genome /<br> reference")
natB <- paf2synteny("W-148_L2_18b.paf", col1 = "darkgreen", col2 = "darkgreen")
natC <- paf2synteny("BCG_Pasteur_bovis_AF2122-97", col1 = "darkgreen", col2 = "darkgreen")
snpmutatorA <- paf2synteny("H37Rv_mutated_9_L4_H37Rv", "(snpmutator)", col1 = "darkgreen", col2 = "orange", my_subtitle = "snpmutator genome /<br> reference")
snpmutatorB <- paf2synteny("18b_mutated_9_L2_18b", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
snpmutatorC <- paf2synteny("AF2122-97_mutated_1_bovis_AF2122-97", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
maketubeA <- paf2synteny("SV2_pop1_H9_L4_H37Rv", "(maketube)", col1 = "darkgreen", col2 = "firebrick", my_subtitle = "maketube genome /<br> reference")
maketubeB <- paf2synteny("SV1_pop1_H1_L2_18b", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
maketubeC <- paf2synteny("SV3_pop1_H10_bovis_AF2122", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
}
big_plot <- (natA / natB / natC) | (snpmutatorA / snpmutatorB / snpmutatorC) | (maketubeA / maketubeB / maketubeC)
big_plot
paf2synteny <- function(pattern_input, target_append = NULL, col1 = "violet", col2 = "purple", my_subtitle = NA, reference = NA){
PAF <- read_paf(list.files("PAF", pattern = pattern_input, full.names = T))
if(!is.null(target_append)){
PAF$qname <- paste(unique(PAF$qname)[1], target_append, sep = "\n")
}
if(is.na(my_subtitle)){
title_format <- element_blank()
} else {
title_format <- element_markdown(
face = "bold",
hjust = 0.5, vjust = 0,
box.color = "black",
linewidth = 0.75, linetype = 1,
padding = margin(10, 30, 10, 30),
margin = margin(0)
)
}
if(!is.na(reference) & (radical(unique(PAF$tname)[1]) == radical(reference))){
tmp <- col1
col1 <- col2
col2 <- tmp
}
if(PAF$tlen[1] >= PAF$qlen[1]){
paf_swapped <- PAF
paf_swapped$qname  <- PAF$tname
paf_swapped$tname  <- PAF$qname
PAF <- paf_swapped
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
scale_y_discrete(labels = c(PAF$qname[1], PAF$tname[1]))
} else {
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
}
plot_object <- ggplot_build(plot)
plot_object$data[[2]][2, "fill"] <- col1
plot_object$data[[2]][1, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
return(plot_recolored)
}
PAF <- read_paf(list.files("PAF", pattern = "H37Rv_mutated_9_L4_H37Rv", full.names = T))
plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1])
{
natA <- paf2synteny("CDC1551_L4_H37Rv", col1 = "darkgreen", col2 = "darkgreen", my_subtitle = "Natural genome /<br> reference")
natB <- paf2synteny("W-148_L2_18b.paf", col1 = "darkgreen", col2 = "darkgreen")
natC <- paf2synteny("BCG_Pasteur_bovis_AF2122-97", col1 = "darkgreen", col2 = "darkgreen")
snpmutatorA <- paf2synteny("H37Rv_mutated_9_L4_H37Rv", "(snpmutator)", col1 = "darkgreen", col2 = "orange", my_subtitle = "snpmutator genome /<br> reference")
snpmutatorB <- paf2synteny("18b_mutated_9_L2_18b", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
snpmutatorC <- paf2synteny("AF2122-97_mutated_1_bovis_AF2122-97", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
maketubeA <- paf2synteny("SV2_pop1_H9_L4_H37Rv", "(maketube)", col1 = "darkgreen", col2 = "firebrick", my_subtitle = "maketube genome /<br> reference")
maketubeB <- paf2synteny("SV1_pop1_H1_L2_18b", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
maketubeC <- paf2synteny("SV3_pop1_H10_bovis_AF2122", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
}
big_plot <- (natA / natB / natC) | (snpmutatorA / snpmutatorB / snpmutatorC) | (maketubeA / maketubeB / maketubeC)
big_plot
paf2synteny <- function(pattern_input, target_append = NULL, col1 = "violet", col2 = "purple", my_subtitle = NA, reference = NA){
PAF <- read_paf(list.files("PAF", pattern = pattern_input, full.names = T))
if(!is.null(target_append)){
PAF$qname <- paste(unique(PAF$qname)[1], target_append, sep = "\n")
}
if(is.na(my_subtitle)){
title_format <- element_blank()
} else {
title_format <- element_markdown(
face = "bold",
hjust = 0.5, vjust = 0,
box.color = "black",
linewidth = 0.75, linetype = 1,
padding = margin(10, 30, 10, 30),
margin = margin(0)
)
}
if(!is.na(reference) & (radical(unique(PAF$tname)[1]) == radical(reference))){
tmp <- col1
col1 <- col2
col2 <- tmp
}
if(PAF$tlen[1] >= PAF$qlen[1]){
paf_swapped <- PAF
paf_swapped$qname  <- PAF$tname
paf_swapped$tname  <- PAF$qname
PAF <- paf_swapped
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
scale_y_discrete(labels = c(PAF$qname[1], PAF$tname[1]))
plot_object <- ggplot_build(plot)
plot_object$data[[2]][1, "fill"] <- col1
plot_object$data[[2]][2, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
} else {
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
plot_object <- ggplot_build(plot)
plot_object$data[[2]][2, "fill"] <- col1
plot_object$data[[2]][1, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
}
return(plot_recolored)
}
{
natA <- paf2synteny("CDC1551_L4_H37Rv", col1 = "darkgreen", col2 = "darkgreen", my_subtitle = "Natural genome /<br> reference")
natB <- paf2synteny("W-148_L2_18b.paf", col1 = "darkgreen", col2 = "darkgreen")
natC <- paf2synteny("BCG_Pasteur_bovis_AF2122-97", col1 = "darkgreen", col2 = "darkgreen")
snpmutatorA <- paf2synteny("H37Rv_mutated_9_L4_H37Rv", "(snpmutator)", col1 = "darkgreen", col2 = "orange", my_subtitle = "snpmutator genome /<br> reference")
snpmutatorB <- paf2synteny("18b_mutated_9_L2_18b", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
snpmutatorC <- paf2synteny("AF2122-97_mutated_1_bovis_AF2122-97", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
maketubeA <- paf2synteny("SV2_pop1_H9_L4_H37Rv", "(maketube)", col1 = "darkgreen", col2 = "firebrick", my_subtitle = "maketube genome /<br> reference")
maketubeB <- paf2synteny("SV1_pop1_H1_L2_18b", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
maketubeC <- paf2synteny("SV3_pop1_H10_bovis_AF2122", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
}
big_plot <- (natA / natB / natC) | (snpmutatorA / snpmutatorB / snpmutatorC) | (maketubeA / maketubeB / maketubeC)
big_plot
paf2synteny <- function(pattern_input, target_append = NULL, col1 = "violet", col2 = "purple", my_subtitle = NA, reference = NA){
PAF <- read_paf(list.files("PAF", pattern = pattern_input, full.names = T))
if(!is.null(target_append)){
PAF$qname <- paste(unique(PAF$qname)[1], target_append, sep = "\n")
}
if(is.na(my_subtitle)){
title_format <- element_blank()
} else {
title_format <- element_markdown(
face = "bold",
hjust = 0.5, vjust = 0,
box.color = "black",
linewidth = 0.75, linetype = 1,
padding = margin(10, 30, 10, 30),
margin = margin(0)
)
}
if(!is.na(reference) & (radical(unique(PAF$tname)[1]) == radical(reference))){
tmp <- col1
col1 <- col2
col2 <- tmp
}
if(PAF$tlen[1] >= PAF$qlen[1]){
paf_swapped <- PAF
paf_swapped$qname  <- PAF$tname
paf_swapped$tname  <- PAF$qname
PAF <- paf_swapped
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
scale_y_discrete(labels = c(PAF$qname[1], PAF$tname[1]))
plot_object <- ggplot_build(plot)
plot_object$data[[2]][1, "fill"] <- col1
plot_object$data[[2]][2, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
} else {
plot <- plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1], rc = F, centre = T) +
ggtitle(label = my_subtitle) +
theme(plot.title = title_format,
axis.title.x = element_blank(),
axis.text.y = element_text(size = 12, face = "bold", hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
plot_object <- ggplot_build(plot)
plot_object$data[[2]][2, "fill"] <- col1
plot_object$data[[2]][1, "fill"] <- col2
plot_recolored <- wrap_ggplot_grob(ggplot_gtable(plot_object))
}
return(plot_recolored)
}
PAF <- read_paf(list.files("PAF", pattern = "H37Rv_mutated_9_L4_H37Rv", full.names = T))
plot_synteny(PAF, q_chrom = unique(PAF$qname)[1], t_chrom = unique(PAF$tname)[1])
{
natA <- paf2synteny("CDC1551_L4_H37Rv", col1 = "darkgreen", col2 = "darkgreen", my_subtitle = "Natural genome /<br> reference")
natB <- paf2synteny("W-148_L2_18b.paf", col1 = "darkgreen", col2 = "darkgreen")
natC <- paf2synteny("BCG_Pasteur_bovis_AF2122-97", col1 = "darkgreen", col2 = "darkgreen")
snpmutatorA <- paf2synteny("H37Rv_mutated_9_L4_H37Rv", "(snpmutator)", col1 = "darkgreen", col2 = "orange", my_subtitle = "snpmutator genome /<br> reference")
snpmutatorB <- paf2synteny("18b_mutated_9_L2_18b", "(snpmutator)", col1 = "darkgreen", col2 = "orange")
snpmutatorC <- paf2synteny("AF2122-97_mutated_1_bovis_AF2122-97", "(snpmutator)", col1 = "orange", col2 = "darkgreen")
maketubeA <- paf2synteny("SV2_pop1_H9_L4_H37Rv", "(maketube)", col1 = "darkgreen", col2 = "firebrick", my_subtitle = "maketube genome /<br> reference")
maketubeB <- paf2synteny("SV1_pop1_H1_L2_18b", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
maketubeC <- paf2synteny("SV3_pop1_H10_bovis_AF2122", "(maketube)", col1 = "darkgreen", col2 = "firebrick")
}
big_plot <- (natA / natB / natC) | (snpmutatorA / snpmutatorB / snpmutatorC) | (maketubeA / maketubeB / maketubeC)
big_plot
{
rm(list = ls())
gc()
graphics.off()
library(ggplot2)
library(scales)
library(ggrepel)
library(ggforce)
library(concaveman)
###removed twice invoked library: ggforce
}
lineages_color <- c(L1 = "darkorchid1", L2 = "dodgerblue2", L3 = "blueviolet",L4 = "firebrick2",L5 =  "darkorange4" ,L6 = "darkgreen",L7 = "gold1", bovis = "black")
###Table does not have headers, chaged to header = F
dnadiff_data <- read.table("distance_to_reference.tsv", header = F, sep = "\t")
colnames(dnadiff_data) <- c("reference", "reference_lineage", "reference_source", "sample", "sample_lineage", "sample_source", "ref_length", "ref_aligned", "sample_length", "sample_aligned")
# is the reference sequence from the same lineage as the sample considered ?
dnadiff_data$relationship <- dnadiff_data$sample_lineage == dnadiff_data$reference_lineage
dnadiff_data$relationship[dnadiff_data$relationship == TRUE] <- "intralineage"
dnadiff_data$relationship[dnadiff_data$relationship == FALSE] <- "interlineage"
###What is the use of lineage_source?
# is the sample considered natural, created by snpmutator or created by maketube
dnadiff_data$sample_source <- factor(dnadiff_data$sample_source, levels = c("natural", "snpmutator", "maketube"), ordered = T)
dnadiff_data$lineage_source <- paste(dnadiff_data$sample_lineage, dnadiff_data$sample_source, sep = ", ")
###I don't think you need this, it just complicate your script and does not change anything
# The % aligned on the reference was still 100% so we removed them for clarity.
sub1 <- subset(dnadiff_data, !(sample_source == "snpmutator" & sample_lineage == "L2"))
###The following left 174 rows
subset_dnadiff <- subset(sub1,
(reference_lineage == sample_lineage & sample_source == "natural") | # only distance to H37Rv if artificial genome ### What do you mean?
(sample_source != "natural" & reference_lineage == sample_lineage) | # only intralineage distance for natural genome ###What fo you mean
(sample_lineage == "L5" & reference_lineage == "bovis") |
(sample_lineage == "L1" & reference_lineage == "L4")
)
#visualisation
#reformating, not interesting
subset_dnadiff$sample_lineage <- as.factor(subset_dnadiff$sample_lineage) ; subset_dnadiff$sample_source <- as.factor(subset_dnadiff$sample_source)
subset_dnadiff$x <- as.numeric(1-subset_dnadiff$ref_aligned/subset_dnadiff$ref_length)
subset_dnadiff$y <- as.numeric(1-subset_dnadiff$sample_aligned/subset_dnadiff$sample_length)
fig3_A <- ggplot(data = subset_dnadiff) +
geom_hline(yintercept = seq(0, 0.013, by = 0.001),
linetype = "dotted", color = "grey", ) +
geom_vline(
xintercept = seq(0, 0.013, by = 0.001),
linetype = "dotted", color = "grey", ) +
geom_point(aes(x = as.numeric(1-ref_aligned/ref_length), y = as.numeric(1-sample_aligned/sample_length), fill = sample_lineage, pch = sample_source), size = 2) +
geom_mark_hull(data = subset_dnadiff, aes(x = x,
y = y,
col = sample_source, label = sample_source),
label.hjust = 0, fill = "grey",
con.type = "elbow", concavity = 10, expand = 0.03, radius = 0.03,
label.fontface = "bold", label.fontsize = 13
) +
scale_shape_manual(values = c(natural = 21, snpmutator = 24, maketube = 25), name = "Genome category :") +
scale_fill_manual(values = lineages_color, name = "Strain lineage") +
scale_color_manual(values = c("maketube" = "firebrick", "snpmutator" = "orange", "natural" = "darkgreen"), guide = "none") +
guides(fill = guide_legend(override.aes = list(pch = 21)),
pch = guide_legend(order = 1)) +
ylab("Sample not covered by reference") +  ###Changed label
xlab("Reference not covered by sample") +  ###Changed label
scale_y_continuous(breaks = seq(0, 1, by = 0.002), labels = scales::percent) + scale_x_continuous(labels = scales::percent, breaks = seq(0, 1, by = 0.002))+
theme_light() +
theme(axis.title.y = element_text(size = 20, face = "bold", hjust = 0.5),
axis.title.x = element_text(size = 20, face = "bold", hjust = 0.5),
axis.text.x = element_text(size = 18, hjust = 0.5),
axis.text.y = element_text(size = 18, hjust = 0.5),
legend.text = element_text(size = 20), legend.title = element_text(size = 18, face = "bold"))
fig3_A
###Here below is for panel A
png("fig3_B_pairwise_nucleotide_distribution.png")
ggplot(subset_dnadiff) +
geom_vline(
xintercept = seq(0, 0.013, by = 0.001),
linetype = "dotted", color = "grey") +
geom_boxplot(aes(sample_source, ((1-ref_aligned/ref_length)+(1-sample_aligned/sample_length))/2, fill = sample_source)) +
scale_fill_manual(values = c("maketube" = "firebrick", "snpmutator" = "orange", "natural" = "darkgreen"), guide = "none") +
xlab("") + ylab("Average pairwise distance") + ###Changed label
scale_y_continuous(breaks = seq(0, 1, by = 0.002), labels = scales::percent) +
theme(axis.title.y = element_text(size = 20, hjust = 0.5),
axis.text.x = element_text(size = 20, hjust = 0.5),
legend.text = element_text(size = 18), legend.title = element_text(size = 20, face = "bold"))
dev.off()
fig3_A <- ggplot(data = subset_dnadiff) +
geom_hline(yintercept = seq(0, 0.013, by = 0.001),
linetype = "dotted", color = "grey", ) +
geom_vline(
xintercept = seq(0, 0.013, by = 0.001),
linetype = "dotted", color = "grey", ) +
geom_point(aes(x = as.numeric(1-ref_aligned/ref_length), y = as.numeric(1-sample_aligned/sample_length), fill = sample_lineage, pch = sample_source), size = 2) +
geom_mark_hull(data = subset_dnadiff, aes(x = x,
y = y,
col = sample_source, label = sample_source),
label.hjust = 0, fill = "grey",
con.type = "elbow", concavity = 10, expand = 0.03, radius = 0.03,
label.fontface = "bold", label.fontsize = 13
) +
scale_shape_manual(values = c(natural = 21, snpmutator = 24, maketube = 25), name = "Genome category :") +
scale_fill_manual(values = lineages_color, name = "Strain lineage") +
scale_color_manual(values = c("maketube" = "firebrick", "snpmutator" = "orange", "natural" = "darkgreen"), guide = "none") +
guides(fill = guide_legend(override.aes = list(pch = 21)),
pch = guide_legend(order = 1)) +
ylab("Sample not covered by reference") +  ###Changed label
xlab("Reference not covered by sample") +  ###Changed label
scale_y_continuous(breaks = seq(0, 1, by = 0.002), labels = scales::percent) + scale_x_continuous(labels = scales::percent, breaks = seq(0, 1, by = 0.002))+
theme_light() +
theme(axis.title.y = element_text(size = 20, face = "bold", hjust = 0.5),
axis.title.x = element_text(size = 20, face = "bold", hjust = 0.5),
axis.text.x = element_text(size = 18, hjust = 0.5),
axis.text.y = element_text(size = 18, hjust = 0.5),
legend.text = element_text(size = 20), legend.title = element_text(size = 18, face = "bold"))
fig3_A
png("fig3_A_pairwise_nucleotide_distance.png", width = 800, height = 800)
fig3_A
dev.off()
png("fig3_A_pairwise_nucleotide_distance.png", width = 1000, height = 1000)
fig3_A
dev.off()
png("fig3_A_pairwise_nucleotide_distance.png", width = 900, height = 900)
fig3_A
dev.off()
